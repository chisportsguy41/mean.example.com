var postsApp=function(){function e(e,t,n){let s=document.getElementById(e);s.addEventListener("submit",function(e){e.preventDefault();let o=new FormData(s),a=`${window.location.origin}${t}`,i=new XMLHttpRequest;i.open(n,a),i.setRequestHeader("Content-Type","application/json; charset=UTF-8");let d={};o.forEach(function(e,t){d[t]=e}),i.send(JSON.stringify(d)),i.onload=function(){!0===JSON.parse(i.response).success?window.location.href="/posts/app":document.getElementById("formMsg").style.display="block"}})}function t(e,t=1){var n="";let s=`${window.location.origin}/api/users/${e}`,o=new XMLHttpRequest;o.open("GET",s),o.setRequestHeader("Content-Type","appllication/json; charset=UTF-8"),o.send(),o.onload=function(){let e=JSON.parse(o.response);n=e.user.first_name+" "+e.user.last_name,document.getElementById("author"+t).innerHTML=n}}return{load:function(){let n=window.location.hash.split("-");switch(n[0]){case"#create":s=document.getElementById("app"),o=new Date,a=6e4*o.getTimezoneOffset(),i=`\n        <div class="card">\n          <div class="card-header clearfix">\n            <h2 class="h3 float-left">Create a New Post</h2>\n            <div class="float-right">\n              <a href="#" class="btn btn-primary">Cancel</a>\n            </div>\n          </div>\n          <div class="card-body">\n          <form id="createPost" class="card-body">\n            <div id="formMsg" class="alert alert-danger text-center">Your form has errors</div>\n              <div class="form-group">\n                <label for="title">Title</label>\n                <input type="text" id="title" name="title" class="form-control" required>\n              </div>\n              <div class="form-group">\n                <label for="body">Body</label>\n                <textarea id="body" name="body" class="form-control" rows="10"></textarea>\n              </div>\n              <div class="row">\n                <div class="form-group col-md-6">\n                  <label for="description">Description</label>\n                  <input type="text" id="description" name="description" class="form-control">\n                </div>\n\n                <div class="form-group col-md-6">\n                  <label for="keywords">Keywords</label>\n                  <input type="text" id="keywords" name="keywords" class="form-control">\n                </div>\n              </div>\n              <div class="form-group">\n                <label for="published">Publication Date</label>\n                <input type="datetime-local" id="published" name="published"\n                class="form-control" value="${new Date(o-a).toISOString().slice(0,16)}">\n              </div>\n              <div class="text-right">\n                <input type="submit" value="Submit" class="btn btn-lg btn-primary btn-sm-block">\n              </div>\n            </form>\n          </div>\n        </div>\n    `,s.innerHTML=i,e("createPost","/api/posts","POST");break;case"#view":!function(e){let n=`${window.location.origin}/api/posts/${e}`,s=new XMLHttpRequest;s.open("GET",n),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.send(),s.onload=function(){let e=document.getElementById("app"),n=JSON.parse(s.response),o="";o=`<div class="card">\n        <div class="card-header clearfix">\n          <h2 class="h3 float-left">${n.post.title}</h2>\n          <div class="float-right">\n            <a href="#edit-${n.post._id}" class="btn btn-primary">Edit</a>\n          </div>\n        </div>\n        <div class="card-body">\n          <p><em>By <span id="author1"></span></em><p>\n          <hr>\n          <div>${n.post.body}</div>\n        </div>\n      </div>`,e.innerHTML=o,t(n.post.userID)}}(n[1]);break;case"#edit":!function(t){let n=`${window.location.origin}/api/posts/${t}`,s=new XMLHttpRequest;s.open("GET",n),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.send(),s.onload=function(){let t=document.getElementById("app"),n=JSON.parse(s.response);var o=new Date(n.post.published),a=6e4*n.post.offset,i=new Date(o-a).toISOString().slice(0,16),d=`\n        <div class="card">\n          <div class="card-header clearfix">\n            <h2 class="h3 float-left">Edit</h2>\n            <div class="float-right">\n              <a href="#" class="btn btn-primary">Cancel</a>\n            </div>\n          </div>\n          <div class="card-body">\n            <form id="editPost" class="card-body">\n              <input type="hidden" id="_id" name="_id" value="${n.post._id}">\n              <div id="formMsg" class="alert alert-danger text-center">Your form has errors</div>\n\n              <div class="form-group">\n                <label for="title">Title</label>\n                <input type="text" id="title" name="title"\n                class="form-control" value="${n.post.title}">\n              </div>\n              <div class="form-group">\n                <label for="body">Body</label>\n                <textarea id="body" name="body" rows="10"\n                class="form-control">${n.post.body}</textarea>\n              </div>\n              <div class="row">\n                <div class="form-group col-md-6">\n                  <label for="description">Description</label>\n                  <input type="text" id="description" name="description"\n                  class="form-control" value="${n.post.description}">\n                </div>\n\n                <div class="form-group col-md-6">\n                  <label for="keywords">Keywords</label>\n                  <input type="text" id="keywords" name="keywords"\n                  class="form-control" value="${n.post.keywords}">\n                </div>\n              </div>\n              <div class="form-group">\n                <label for="published">Publication Date</label>\n                <input type="datetime-local" id="published" name="published"\n                class="form-control" value="${i}">\n              </div>\n\n              <div class="text-right">\n                <input type="submit" value="Submit" class="btn btn-lg btn-primary btn-sm-block">\n              </div>\n              <div>\n                <a href="#delete-${n.post._id}" class="text-danger">Delete</a>\n              </div>\n            </form>\n          </div>\n        </div>\n      `;t.innerHTML=d,e("editPost","/api/posts","PUT")}}(n[1]);break;case"#delete":!function(e){let t=`${window.location.origin}/api/posts/${e}`,n=new XMLHttpRequest;n.open("GET",t),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send(),n.onload=function(){let e=document.getElementById("app"),t=JSON.parse(n.response),s="";s=`<div class="card bg-transparent border-danger text-danger bg-danger">\n        <div class="card-header bg-transparent border-danger">\n          <h2 class="h3 text-center">You're About to Delete a Post</h2>\n        </div>\n        <div class="card-body text-center">\n          <div>\n            <p>Are you sure you want to delete this post?</p>\n            <p><strong>${t.post.title}</strong></p>\n          </div>\n          <div class="text-center">\n            <br>\n            <a onclick="postsApp.deletePost('${t.post._id}');"\n            class="btn btn-lg btn-danger text-white">\n              Yes, delete this post.\n            </a>\n          </div>\n\n        </div>\n      </div>`,e.innerHTML=s}}(n[1]);break;default:!function(){let e=`${window.location.origin}/api/posts`,n=new XMLHttpRequest;n.open("GET",e),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send(),n.onload=function(){let e=document.getElementById("app"),s=JSON.parse(n.response).posts,o="",a="";for(let e=0;e<s.length;e++){var i=new Date(s[e].published),d=6e4*s[e].offset,r=new Date(i-d).toISOString().slice(0,16).replace("T"," ");a+=`<tr>\n          <td>\n            <a href="#view-${s[e]._id}">${s[e].title}</a>\n          </td>\n          <td id="author${e}"></td>\n          <td>${s[e].description}</td>\n          <td>${r}</td>\n          <td><a href="#edit-${s[e]._id}">Edit</a> | <a href="#delete-${s[e]._id}">Delete</a></td>\n        </tr>`,t(s[e].userID,e)}o=`<div class="card">\n        <div class="card-header clearfix">\n          <h3 class="h3 float-left">Posts</h3>\n          <div class="float-right">\n            <a href="#create" class="btn btn-primary">New Post</a>\n          </div>\n        </div>\n        <div class="table-responsive">\n          <table class="table table-striped table-hover table-bordered">\n            <thead>\n              <tr>\n                <td>Title</td>\n                <td>Author</td>\n                <td>Description</td>\n                <td>Published</td>\n                <td>Actions</td>\n              </tr>\n            </thead>\n            <tbody>${a}</tbody>\n          </table>\n        </div>\n      </div>`,e.innerHTML=o}}()}var s,o,a,i},deletePost:function(e){!function(e){let t=`${window.location.origin}/api/posts/${e}`,n=new XMLHttpRequest;n.open("DELETE",t),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send(),n.onload=function(){!0===JSON.parse(n.response).success?window.location.hash="#":alert("Unknown error, the user could not be deleted")}}(e)}}}();postsApp.load(),window.addEventListener("hashchange",function(){postsApp.load()});